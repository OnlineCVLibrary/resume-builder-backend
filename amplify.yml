version: 0.2

phases:
  install:
    commands:
      - echo "20" > .nvmrc
      - nvm install 20
      - nvm use 20
  pre_build:
    commands:
      - npm ci --cache .npm --prefer-offline --legacy-peer-deps
      - echo "Checking cache bucket..."
      - aws s3 ls s3://your-cache-bucket-name || echo "Cache bucket not found"
  build:
    commands:
      - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
  post_build:
    commands:
      - echo "Build completed successfully"

cache:
  paths:
    - .npm/**/*
    - node_modules/**/*
    - amplify/.amplify/artifacts/cache/**/*